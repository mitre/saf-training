import{_ as r}from"./plugin-vue_export-helper.21dcd24c.js";import{r as i,o as c,c as p,a as s,b as e,w as t,F as d,e as n,d as l}from"./app.3b4d192a.js";var u="/saf-training/assets/NGINX_Heimdall_Results_View.8dcccfa8.png";const h={},b=s("h2",{id:"_3-revisiting-the-nginx-web-server-inspec-profile",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_3-revisiting-the-nginx-web-server-inspec-profile","aria-hidden":"true"},"#"),n(" 3. Revisiting the NGINX Web Server InSpec Profile")],-1),m=n("In the "),v=n("beginner class"),g=n(", we wrote, ran, and analyzed results of an InSpec profile made up of controls. Let's recap this process with some practice."),k=l(`<h2 id="_3-1-the-requirements" tabindex="-1"><a class="header-anchor" href="#_3-1-the-requirements" aria-hidden="true">#</a> 3.1 The Requirements</h2><h3 id="_3-1-1-nginx-configuration" tabindex="-1"><a class="header-anchor" href="#_3-1-1-nginx-configuration" aria-hidden="true">#</a> 3.1.1 NGINX Configuration</h3><p>InSpec profiles are a set of automated tests that relate back to a security requirements benchmark, so the controls are always motivated by the requirements. Let&#39;s review a few requirements for an NGINX web server.</p><ol><li>NGINX version 1.10.3 or later.</li><li>The following NGINX modules should be installed: <ul><li><code>http_ssl</code></li><li><code>stream_ssl</code></li><li><code>mail_ssl</code></li></ul></li><li>The NGINX configuration file - <code>/etc/nginx/nginx.conf</code>- should: <ul><li>be owned by the <code>root</code> user and group.</li><li>not be readable, writeable, or executable by others.</li></ul></li></ol><h2 id="_3-2-the-target" tabindex="-1"><a class="header-anchor" href="#_3-2-the-target" aria-hidden="true">#</a> 3.2 The Target</h2><h3 id="_3-2-1-an-nginx-web-server" tabindex="-1"><a class="header-anchor" href="#_3-2-1-an-nginx-web-server" aria-hidden="true">#</a> 3.2.1 An NGINX Web Server</h3><p>InSpec is a framework which is used to validate the security configuration of a certain target. In this case, we are interested in validating that an NGINX server complies with our 3 requirements.</p><p>First let&#39;s find our nginx container id using the <code>docker ps</code> command:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">ps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Which will return something like:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  course git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> \u2717 <span class="token function">docker</span> <span class="token function">ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                NAMES
d4bcef5bb9e3   nginx:latest   <span class="token string">&quot;/docker-entrypoint.\u2026&quot;</span>   <span class="token number">23</span> seconds ago   Up <span class="token number">22</span> seconds   <span class="token number">80</span>/tcp               nifty_shtern
4f0ceb9b5974   nginx:latest   <span class="token string">&quot;/docker-entrypoint.\u2026&quot;</span>   <span class="token number">2</span> months ago     Up <span class="token number">45</span> seconds   <span class="token number">0.0</span>.0.0:80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We can then use the container id of our nginx container to target the inspec validation scans at that container.</p><h2 id="_3-3-the-controls" tabindex="-1"><a class="header-anchor" href="#_3-3-the-controls" aria-hidden="true">#</a> 3.3 The Controls</h2><p>Run the following command to initialize your InSpec profile for testing NGINX.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>inspec init profile my_nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-1-version" tabindex="-1"><a class="header-anchor" href="#_3-3-1-version" aria-hidden="true">#</a> 3.3.1 Version</h3><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>control <span class="token string-literal"><span class="token string">&#39;nginx-version&#39;</span></span> <span class="token keyword">do</span>
  impact <span class="token number">1.0</span>
  title <span class="token string-literal"><span class="token string">&#39;NGINX version&#39;</span></span>
  desc <span class="token string-literal"><span class="token string">&#39;The required version of NGINX should be installed.&#39;</span></span>
  describe nginx <span class="token keyword">do</span>
    its<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;version&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should cmp <span class="token operator">&gt;=</span> <span class="token string-literal"><span class="token string">&#39;1.10.3&#39;</span></span> <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-2-installed-modules" tabindex="-1"><a class="header-anchor" href="#_3-3-2-installed-modules" aria-hidden="true">#</a> 3.3.2 Installed Modules</h3><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>control <span class="token string-literal"><span class="token string">&#39;nginx-modules&#39;</span></span> <span class="token keyword">do</span>
  impact <span class="token number">1.0</span>
  title <span class="token string-literal"><span class="token string">&#39;NGINX modules&#39;</span></span>
  desc <span class="token string-literal"><span class="token string">&#39;The required NGINX modules should be installed.&#39;</span></span>
  describe nginx <span class="token keyword">do</span>
    its<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;modules&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should <span class="token keyword">include</span> <span class="token string-literal"><span class="token string">&#39;http_ssl&#39;</span></span> <span class="token punctuation">}</span>
    its<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;modules&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should <span class="token keyword">include</span> <span class="token string-literal"><span class="token string">&#39;stream_ssl&#39;</span></span> <span class="token punctuation">}</span>
    its<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;modules&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> should <span class="token keyword">include</span> <span class="token string-literal"><span class="token string">&#39;mail_ssl&#39;</span></span> <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-3-file-permissions" tabindex="-1"><a class="header-anchor" href="#_3-3-3-file-permissions" aria-hidden="true">#</a> 3.3.3 File Permissions</h3><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>control <span class="token string-literal"><span class="token string">&#39;nginx-conf&#39;</span></span> <span class="token keyword">do</span>
  impact <span class="token number">1.0</span>
  title <span class="token string-literal"><span class="token string">&#39;NGINX configuration&#39;</span></span>
  desc <span class="token string-literal"><span class="token string">&#39;The NGINX config file should owned by root, be writable only by owner, and not writeable or and readable by others.&#39;</span></span>
  describe file<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;/etc/nginx/nginx.conf&#39;</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span>
    it <span class="token punctuation">{</span> should be_owned_by <span class="token string-literal"><span class="token string">&#39;root&#39;</span></span> <span class="token punctuation">}</span>
    it <span class="token punctuation">{</span> should be_grouped_into <span class="token string-literal"><span class="token string">&#39;root&#39;</span></span> <span class="token punctuation">}</span>
    it <span class="token punctuation">{</span> should_not be_readable<span class="token punctuation">.</span>by<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;others&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    it <span class="token punctuation">{</span> should_not be_writable<span class="token punctuation">.</span>by<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;others&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    it <span class="token punctuation">{</span> should_not be_executable<span class="token punctuation">.</span>by<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;others&#39;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-4-running-the-controls" tabindex="-1"><a class="header-anchor" href="#_3-4-running-the-controls" aria-hidden="true">#</a> 3.4 Running the Controls</h2><p>Run <code>inspec exec</code> on the target.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ inspec <span class="token builtin class-name">exec</span> /root/my_nginx -t docker://DOCKER_CONTAINER_ID
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This will ouput:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>  Profile: InSpec Profile <span class="token punctuation">(</span>my_nginx<span class="token punctuation">)</span>
  Version: <span class="token number">0.1</span>.0
  Target:  docker://DOCKER_CONTAINER_ID

    \u2714  nginx-version: NGINX version
       \u2714  Nginx Environment version should <span class="token function">cmp</span> <span class="token operator">&gt;=</span> <span class="token string">&quot;1.10.3&quot;</span>
    \u2714  nginx-modules: NGINX version
       \u2714  Nginx Environment modules should include <span class="token string">&quot;http_ssl&quot;</span>
       \u2714  Nginx Environment modules should include <span class="token string">&quot;stream_ssl&quot;</span>
       \u2714  Nginx Environment modules should include <span class="token string">&quot;mail_ssl&quot;</span>
    \xD7  nginx-conf: NGINX configuration <span class="token punctuation">(</span><span class="token number">1</span> failed<span class="token punctuation">)</span>
       \u2714  File /etc/nginx/nginx.conf should be owned by <span class="token string">&quot;root&quot;</span>
       \u2714  File /etc/nginx/nginx.conf should be grouped into <span class="token string">&quot;root&quot;</span>
       \xD7  File /etc/nginx/nginx.conf should not be readable by others
       expected File /etc/nginx/nginx.conf not to be readable by others
       \u2714  File /etc/nginx/nginx.conf should not be writable by others
       \u2714  File /etc/nginx/nginx.conf should not be executable by others


  Profile Summary: <span class="token number">2</span> successful controls, <span class="token number">1</span> control failure, <span class="token number">0</span> controls skipped
  Test Summary: <span class="token number">8</span> successful, <span class="token number">1</span> failure, <span class="token number">0</span> skipped
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-5-reporting-results" tabindex="-1"><a class="header-anchor" href="#_3-5-reporting-results" aria-hidden="true">#</a> 3.5 Reporting Results</h2>`,27),_=n("In the "),f=n("beginner class"),x=n(", we mentioned that you can specify an InSpec reporter to indicate the format in which you desire the results."),y=l(`<p>If you want to read the results on the command line as well as save them in a JSON file, you can run this command.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ inspec <span class="token builtin class-name">exec</span> /root/my_nginx --reporter cli json:path/to/output.json -t docker://DOCKER_CONTAINER_ID
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3-6-visualizing-results" tabindex="-1"><a class="header-anchor" href="#_3-6-visualizing-results" aria-hidden="true">#</a> 3.6 Visualizing Results</h2>`,3),N=n("You can use this output file to upload and visualize your results in "),w={href:"https://heimdall-lite.mitre.org/",target:"_blank",rel:"noopener noreferrer"},I=n("Heimdall"),q=n("."),T=s("p",null,[s("img",{src:u,alt:"Alt text",loading:"lazy"})],-1),G=s("hr",null,null,-1);function R(X,E){const a=i("RouterLink"),o=i("ExternalLinkIcon");return c(),p(d,null,[b,s("p",null,[m,e(a,{to:"/courses/beginner/05.html"},{default:t(()=>[v]),_:1}),g]),k,s("p",null,[_,e(a,{to:"/courses/beginner/06.html"},{default:t(()=>[f]),_:1}),x]),y,s("p",null,[N,s("a",w,[I,e(o)]),q]),T,G],64)}var A=r(h,[["render",R],["__file","03.html.vue"]]);export{A as default};
