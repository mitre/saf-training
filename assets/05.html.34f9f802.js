import{_ as t}from"./plugin-vue_export-helper.21dcd24c.js";import{r as p,o,c as i,a as n,b as e,F as c,e as s,d as l}from"./app.3b4d192a.js";var u="/saf-training/assets/CI_Pipeline_Flow_EC2_Example.b3b9d5f7.png";const r={},k=n("h3",{id:"_5-1-pipeline-example",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_5-1-pipeline-example","aria-hidden":"true"},"#"),s(" 5.1. Pipeline example")],-1),d=s("Below is a "),m={href:"https://github.com/mitre/redhat-enterprise-linux-7-stig-baseline/blob/master/.github/workflows/verify-ec2.yml",target:"_blank",rel:"noopener noreferrer"},v=s("RedHat 7 example"),h=s(" of an automated pipeline that creates and configures two machines with the RedHat 7 operating system - one of which is set up as a vanilla configuration, and one of which is hardened using hardening scripts run by the Chef configuration management tool called kitchen."),b=l('<div class="custom-container info"><p class="custom-container-title">Modularity in Automation</p><p>We will demonstrate the automation process through this example, but note that the different orchestration tools, configuration mangement tools, and targets can be traded out for different uses while following the same automation flow and security automation framework.</p></div><p><img src="'+u+`" alt="Alt text" loading="lazy"></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> EC2 Testing Matrix

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> master <span class="token punctuation">]</span>
  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> master <span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">my-job</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Validate my profile
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">CHEF_LICENSE</span><span class="token punctuation">:</span> accept<span class="token punctuation">-</span>silent
      <span class="token key atrule">KITCHEN_LOCAL_YAML</span><span class="token punctuation">:</span> kitchen.ec2.yml
    <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">matrix</span><span class="token punctuation">:</span>
        <span class="token key atrule">suite</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;vanilla&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;hardened&#39;</span><span class="token punctuation">]</span>
      <span class="token key atrule">fail-fast</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add needed packages
        <span class="token key atrule">run</span><span class="token punctuation">:</span> sudo apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y jq
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Configure AWS credentials
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">AWS_SG_ID</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.AWS_SG_ID <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">AWS_SUBNET_ID</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.AWS_SUBNET_ID <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> aws<span class="token punctuation">-</span>actions/configure<span class="token punctuation">-</span>aws<span class="token punctuation">-</span>credentials@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">aws-access-key-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.AWS_ACCESS_KEY_ID <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">aws-secret-access-key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.AWS_SECRET_ACCESS_KEY <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">aws-region</span><span class="token punctuation">:</span> us<span class="token punctuation">-</span>east<span class="token punctuation">-</span><span class="token number">1</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Check out repository
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Clone full repository so we can push
        <span class="token key atrule">run</span><span class="token punctuation">:</span> git fetch <span class="token punctuation">-</span><span class="token punctuation">-</span>prune <span class="token punctuation">-</span><span class="token punctuation">-</span>unshallow
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup Ruby
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> ruby/setup<span class="token punctuation">-</span>ruby@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">ruby-version</span><span class="token punctuation">:</span> <span class="token string">&#39;2.7&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Disable ri and rdoc
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token string">&#39;echo &quot;gem: --no-ri --no-rdoc&quot; &gt;&gt; ~/.gemrc&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> bundle install
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Regenerate current \`profile.json\`
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          bundle exec inspec json . | jq . &gt; profile.json</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Lint the Inspec profile
        <span class="token key atrule">run</span><span class="token punctuation">:</span> bundle exec inspec check .
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run kitchen test
        <span class="token key atrule">run</span><span class="token punctuation">:</span> bundle exec kitchen test <span class="token punctuation">-</span><span class="token punctuation">-</span>destroy=always $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.suite <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>rhel<span class="token punctuation">-</span>7 <span class="token punctuation">|</span><span class="token punctuation">|</span> true
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Display our $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.suite <span class="token punctuation">}</span><span class="token punctuation">}</span> results summary
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> mitre/saf_action@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">command_string</span><span class="token punctuation">:</span> <span class="token string">&#39;view:summary -i spec/results/ec2_rhel-7_\${{ matrix.suite }}.json&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure the scan meets our $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.suite <span class="token punctuation">}</span><span class="token punctuation">}</span> results threshold
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> mitre/saf_action@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">command_string</span><span class="token punctuation">:</span> <span class="token string">&#39;validate:threshold -i spec/results/ec2_rhel-7_\${{ matrix.suite }}.json -F \${{ matrix.suite }}.threshold.yml&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Save Test Result JSON
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>artifact@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> spec/results/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The two machines are then tested, which runs an InSpec profile. The results are viewed and validated against a threshold to allow the pipeline to automatically pass or fail based on whether the results meet those thresholds. The SAF CLI is used to view and validate.</p>`,4),_={class:"custom-container tip"},y=n("p",{class:"custom-container-title"},"Use Examples to Help Automate",-1),f=s("To get more information on setting up the whole automation pipeline for your use case, use examples, such as the "),g={href:"https://github.com/mitre/redhat-enterprise-linux-7-stig-baseline/",target:"_blank",rel:"noopener noreferrer"},w=s("RedHat 7 repository"),x=s(". You can view results of the workflows in the "),S={href:"https://github.com/mitre/redhat-enterprise-linux-7-stig-baseline/actions",target:"_blank",rel:"noopener noreferrer"},A=s("Actions tab"),C=s("."),E=n("h3",{id:"_5-2-saf-cli-github-action",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_5-2-saf-cli-github-action","aria-hidden":"true"},"#"),s(" 5.2. SAF CLI GitHub Action")],-1),I=s("The SAF has several ways of easing the automation process. If you are using a GitHub pipeline, such as this example, you can use the "),T={href:"https://github.com/marketplace/actions/saf-cli-action",target:"_blank",rel:"noopener noreferrer"},L=s("SAF CLI GitHub Action"),$=s(".");function j(F,H){const a=p("ExternalLinkIcon");return o(),i(c,null,[k,n("p",null,[d,n("a",m,[v,e(a)]),h]),b,n("div",_,[y,n("p",null,[f,n("a",g,[w,e(a)]),x,n("a",S,[A,e(a)]),C])]),E,n("p",null,[I,n("a",T,[L,e(a)]),$])],64)}var W=t(r,[["render",j],["__file","05.html.vue"]]);export{W as default};
