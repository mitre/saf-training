const A=(e,s,h)=>{let n;const a=s,r={ok:!1,pos:s,value:""};for(n=e.charAt(s);s<h&&n.match(/\d/)||n==="%";)n=e.charAt(++s);return r.ok=!0,r.pos=s,r.value=e.slice(a,s),r},g=(e,s,h)=>{const n={ok:!1,pos:0,width:"",height:""};if(s>=h||e.charAt(s)!=="=")return n;s+=1;const a=e.charAt(s);if(a!=="x"&&!a.match(/\d/))return n;const r=A(e,s,h);if(s=r.pos,e.charAt(s)!=="x")return n;s+=1;const i=A(e,s,h);return s=i.pos,n.width=r.value,n.height=i.value,n.pos=s,n.ok=!0,n},k=(e,s)=>{const h=e.env,n=e.pos,a=e.posMax;if(e.src.charAt(e.pos)!=="!"||e.src.charAt(e.pos+1)!=="[")return!1;const r=e.pos+2,i=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(i<0)return!1;let t=i+1,o,p="",l="",m="",d="";if(t<a&&e.src.charAt(t)==="("){for(t+=1;t<a&&(o=e.src.charAt(t),!(o!==" "&&o!=="	"));t++);if(t>=a)return!1;let c;c=e.md.helpers.parseLinkDestination(e.src,t,e.posMax),c.ok&&(p=e.md.normalizeLink(c.str),e.md.validateLink(p)?t=c.pos:p="");const f=t;for(;t<a&&(o=e.src.charAt(t),!(o!==" "&&o!=="	"));t++);if(c=e.md.helpers.parseLinkTitle(e.src,t,e.posMax),t<a&&f!==t&&c.ok)for(l=c.str,t=c.pos;t<a&&(o=e.src.charAt(t),!(o!==" "&&o!=="	"));t++);else l="";if(t-1>=0&&(o=e.src.charAt(t-1),o===" "&&(c=g(e.src,t,e.posMax),c.ok)))for(m=c.width,d=c.height,t=c.pos;t<a&&(o=e.src.charAt(t),!(o!==" "&&o!==`
`));t++);if(t>=a||e.src.charAt(t)!==")")return e.pos=n,!1;t+=1}else{let c="";if(typeof h.references>"u")return!1;for(;t<a&&(o=e.src.charAt(t),!(o!==" "&&o!=="	"));t++);if(t<a&&e.src.charAt(t)==="["){const u=t+1;t=e.md.helpers.parseLinkLabel(e,t),t>=0?c=e.src.slice(u,t++):t=i+1}else t=i+1;c||(c=e.src.slice(r,i));const f=h.references[e.md.utils.normalizeReference(c)];if(!f)return e.pos=n,!1;p=f.href,l=f.title||""}if(!s){e.pos=r,e.posMax=i;const c=e.src.slice(r,i),f=[];e.md.inline.parse(c,e.md,e.env,f);const u=e.push("image","img",0);u.attrs=[["src",p],["alt",""]],l&&u.attrs.push(["title",l]),m!==""&&u.attrs.push(["width",m]),d!==""&&u.attrs.push(["height",d]),u.children=f,u.content=c}return e.pos=t,e.posMax=a,!0},x=e=>{e.inline.ruler.before("emphasis","image",k)},L=e=>{const s=e.renderer.rules.image;e.renderer.rules.image=(h,n,a,r,i)=>{const t=h[n],o=t.children?.[0]?.content;if(o){const p=/^(.*)\|(\d*)(?:x(\d*))?$/.exec(o);if(p){const[,l,m,d]=p;t.content=l,t.children[0].content=l,t.attrSet("width",m),typeof d=="string"&&t.attrSet("height",d)}}return s(h,n,a,r,i)}};export{x as imgSize,L as obsidianImageSize};
//# sourceMappingURL=index.mjs.map
