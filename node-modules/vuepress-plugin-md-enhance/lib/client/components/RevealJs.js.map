{"version":3,"file":"RevealJs.js","sources":["../../../src/client/components/RevealJs.ts"],"sourcesContent":["import { usePageFrontmatter } from \"@vuepress/client\";\nimport type Reveal from \"reveal.js/dist/reveal.esm.js\";\nimport type { PropType, VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n} from \"vue\";\nimport { LoadingIcon, atou } from \"vuepress-shared/client\";\n\nimport { useRevealJs } from \"@temp/md-enhance/revealjs-plugins.js\";\n\nimport { useRevealJsConfig } from \"../helpers/index.js\";\n\nimport \"../styles/revealjs/index.scss\";\nimport \"../styles/revealjs/theme/fonts/league-gothic/league-gothic.css\";\nimport \"../styles/revealjs/theme/fonts/source-sans-pro/source-sans-pro.css\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\ntype ThemeType =\n  | \"auto\"\n  | \"black\"\n  | \"white\"\n  | \"league\"\n  | \"beige\"\n  | \"sky\"\n  | \"night\"\n  | \"serif\"\n  | \"simple\"\n  | \"solarized\"\n  | \"blood\"\n  | \"moon\";\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"RevealJs\",\n\n  props: {\n    /**\n     * Presentation id\n     *\n     * 幻灯片 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Presentation code\n     *\n     * 幻灯片代码\n     */\n    code: { type: String, required: true },\n\n    /**\n     * Presentation theme\n     *\n     * 幻灯片主题\n     */\n    theme: { type: String as PropType<ThemeType>, default: \"auto\" },\n  },\n\n  setup(props) {\n    const revealOptions = useRevealJsConfig();\n    const frontmatter = usePageFrontmatter<{ revealJs: Reveal.Options }>();\n    const code = ref(\"\");\n    const loading = ref(true);\n    const presentationContainer = shallowRef<HTMLElement>();\n\n    let reveal: Reveal.Api | null = null;\n\n    const initRevealJs = async (\n      container: HTMLElement,\n    ): Promise<Reveal.Api> => {\n      const promises: [Promise<void>, ...ReturnType<typeof useRevealJs>] = [\n        new Promise((resolve) => setTimeout(resolve, MARKDOWN_ENHANCE_DELAY)),\n        ...useRevealJs(),\n      ];\n\n      const [, revealJs, ...plugins] = await Promise.all(promises);\n\n      const reveal = new revealJs.default(container, {\n        backgroundTransition: \"slide\",\n        hash: frontmatter.value.layout === \"Slide\",\n        mouseWheel: frontmatter.value.layout === \"Slide\",\n        transition: \"slide\",\n        slideNumber: true,\n        ...revealOptions,\n        ...(frontmatter.value.revealJs || {}),\n        embedded: frontmatter.value.layout !== \"Slide\",\n        markdown: {\n          // FIXME: https://github.com/DefinitelyTyped/DefinitelyTyped/pull/67226\n          // @ts-ignore\n          separator: \"^\\r?\\\\n---\\r?\\n$\",\n          // @ts-ignore\n          verticalSeparator: \"^\\r?\\n--\\r?\\n$\",\n        },\n\n        plugins: [\n          ...plugins.map(({ default: plugin }) => plugin),\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n          ...(revealOptions.plugins ?? []),\n        ],\n      });\n\n      await reveal.initialize();\n\n      return reveal;\n    };\n\n    onMounted(async () => {\n      const container = presentationContainer.value;\n\n      if (container) {\n        code.value = atou(props.code);\n\n        container.setAttribute(\"id\", props.id);\n        container.setAttribute(\"data-theme\", props.theme);\n\n        reveal = await initRevealJs(container);\n\n        loading.value = false;\n      }\n    });\n\n    onUnmounted(() => {\n      reveal?.destroy();\n    });\n\n    return (): VNode =>\n      h(\"div\", { class: \"vp-reveal\" }, [\n        h(\n          \"div\",\n          {\n            ref: presentationContainer,\n            class: [\"reveal\", \"reveal-viewport\"],\n          },\n          h(\"div\", {\n            class: \"slides\",\n            innerHTML: `<section data-markdown><script type=\"text/template\">${code.value}</script></section>`,\n          }),\n        ),\n        loading.value\n          ? h(LoadingIcon, { class: \"reveal-loading\", height: 400 })\n          : null,\n      ]);\n  },\n});\n"],"names":["defineComponent","props","revealOptions","useRevealJsConfig","frontmatter","usePageFrontmatter","code","ref","loading","presentationContainer","shallowRef","reveal","initRevealJs","container","promises","resolve","useRevealJs","revealJs","plugins","plugin","onMounted","atou","onUnmounted","h","LoadingIcon"],"mappings":"kgBAqCA,IAAeA,EAAAA,EAAgB,CAE7B,KAAM,WAEN,MAAO,CAML,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,KAAM,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOrC,MAAO,CAAE,KAAM,OAA+B,QAAS,MAAO,CAChE,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,EAAkB,EAClCC,EAAcC,IACdC,EAAOC,EAAI,EAAE,EACbC,EAAUD,EAAI,EAAI,EAClBE,EAAwBC,IAE9B,IAAIC,EAA4B,KAEhC,MAAMC,EAAe,MACnBC,GACwB,CACxB,MAAMC,EAA+D,CACnE,IAAI,QAASC,GAAY,WAAWA,EAAS,sBAAsB,CAAC,EACpE,GAAGC,EACL,CAAA,EAEM,CAAGC,CAAAA,EAAU,GAAGC,CAAO,EAAI,MAAM,QAAQ,IAAIJ,CAAQ,EAErDH,EAAS,IAAIM,EAAS,QAAQJ,EAAW,CAC7C,qBAAsB,QACtB,KAAMT,EAAY,MAAM,SAAW,QACnC,WAAYA,EAAY,MAAM,SAAW,QACzC,WAAY,QACZ,YAAa,GACb,GAAGF,EACH,GAAIE,EAAY,MAAM,UAAY,CAAC,EACnC,SAAUA,EAAY,MAAM,SAAW,QACvC,SAAU,CAGR,UAAW;AAAA,GAEX,kBAAmB;AAAA;AAAA,EACrB,EAEA,QAAS,CACP,GAAGc,EAAQ,IAAI,CAAC,CAAE,QAASC,CAAO,IAAMA,CAAM,EAE9C,GAAIjB,EAAc,SAAW,CAC/B,CAAA,CACF,CAAC,EAED,OAAA,MAAMS,EAAO,WAAA,EAENA,CACT,EAEA,OAAAS,EAAU,SAAY,CACpB,MAAMP,EAAYJ,EAAsB,MAEpCI,IACFP,EAAK,MAAQe,EAAKpB,EAAM,IAAI,EAE5BY,EAAU,aAAa,KAAMZ,EAAM,EAAE,EACrCY,EAAU,aAAa,aAAcZ,EAAM,KAAK,EAEhDU,EAAS,MAAMC,EAAaC,CAAS,EAErCL,EAAQ,MAAQ,GAEpB,CAAC,EAEDc,EAAY,IAAM,CAChBX,GAAQ,QACV,CAAA,CAAC,EAEM,IACLY,EAAE,MAAO,CAAE,MAAO,WAAY,EAAG,CAC/BA,EACE,MACA,CACE,IAAKd,EACL,MAAO,CAAC,SAAU,iBAAiB,CACrC,EACAc,EAAE,MAAO,CACP,MAAO,SACP,UAAW,uDAAuDjB,EAAK,KAAK,sBAC9E,CAAC,CACH,EACAE,EAAQ,MACJe,EAAEC,EAAa,CAAE,MAAO,iBAAkB,OAAQ,GAAI,CAAC,EACvD,IACN,CAAC,CACL,CACF,CAAC"}