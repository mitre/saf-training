{"version":3,"file":"VideoPlayer.js","sources":["../../../src/client/components/VideoPlayer.ts"],"sourcesContent":["import { isArray } from \"@vuepress/shared\";\nimport type { UseMediaTextTrackSource } from \"@vueuse/core\";\nimport type { Options as PlyrOptions } from \"plyr\";\nimport type { PropType, VNode } from \"vue\";\nimport {\n  computed,\n  defineComponent,\n  h,\n  onBeforeMount,\n  onMounted,\n  shallowRef,\n} from \"vue\";\n\nimport { getLink } from \"../utils/index.js\";\n\nimport \"plyr/dist/plyr.css\";\nimport \"../styles/video-player.scss\";\n\nexport interface VidePlayerSource {\n  src: string;\n  type: string;\n  size: string | number;\n}\n\nexport default defineComponent({\n  name: \"VideoPlayer\",\n\n  props: {\n    /** Options object for plyr config. **/\n    options: {\n      type: Object as PropType<PlyrOptions>,\n      default: () => ({}),\n    },\n\n    /**\n     * Video source\n     *\n     * 视频源\n     */\n    src: {\n      type: [String, Array] as PropType<string | VidePlayerSource[]>,\n      required: true,\n    },\n\n    /**\n     * Video title\n     *\n     * 视频标题\n     */\n    title: {\n      type: String,\n      default: \"A video\",\n    },\n\n    /**\n     * Video file type\n     *\n     * 视频文件类型\n     */\n    type: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Video tracks\n     *\n     * 视频字幕\n     */\n    tracks: {\n      type: Array as PropType<UseMediaTextTrackSource[]>,\n      default: (): UseMediaTextTrackSource[] => [],\n    },\n\n    /**\n     * Video poster\n     *\n     * 视频封面\n     */\n    poster: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Component width\n     *\n     * 组件宽度\n     */\n    width: {\n      type: [String, Number],\n      default: \"100%\",\n    },\n\n    /**\n     * Whether to loop the video\n     *\n     * 是否循环播放\n     */\n    loop: Boolean,\n  },\n\n  setup(props) {\n    let player: Plyr | null = null;\n    const video = shallowRef<HTMLVideoElement>();\n\n    const plyrOptions = computed(() => ({\n      hideYouTubeDOMError: true,\n      ...props.options,\n    }));\n\n    onMounted(async () => {\n      const { default: Plyr } = await import(\n        /* webpackChunkName: \"plyr\" */ \"plyr\"\n      );\n\n      player = new Plyr(video.value!, plyrOptions.value);\n    });\n\n    onBeforeMount(() => {\n      try {\n        player?.destroy();\n      } catch (err: unknown) {\n        // do nothing\n      }\n    });\n\n    return (): VNode =>\n      h(\n        \"div\",\n        {\n          class: \"vp-video-player\",\n          style: {\n            width: props.width,\n          },\n        },\n        [\n          h(\n            \"a\",\n            {\n              class: \"sr-only\",\n              href: getLink(isArray(props.src) ? props.src[0].src : props.src),\n            },\n            props.title,\n          ),\n          h(\n            \"video\",\n            {\n              ref: video,\n              title: props.title,\n              crossorigin: \"anonymous\",\n              poster: getLink(props.poster),\n              preload: \"metadata\",\n              controls: \"\",\n              ...(props.loop ? { loop: \"\" } : {}),\n            },\n            [\n              props.tracks.map((track) =>\n                h(\"track\", { ...track, src: getLink(track.src) }),\n              ),\n              isArray(props.src)\n                ? props.src.map((item) => h(\"source\", item))\n                : h(\"source\", { src: getLink(props.src), type: props.type }),\n            ],\n          ),\n        ],\n      );\n  },\n});\n"],"names":["defineComponent","props","player","video","shallowRef","plyrOptions","computed","onMounted","Plyr","onBeforeMount","h","getLink","isArray","track","item"],"mappings":"2RAwBA,IAAeA,EAAAA,EAAgB,CAC7B,KAAM,cAEN,MAAO,CAEL,QAAS,CACP,KAAM,OACN,QAAS,KAAO,CAClB,EAAA,EAOA,IAAK,CACH,KAAM,CAAC,OAAQ,KAAK,EACpB,SAAU,EACZ,EAOA,MAAO,CACL,KAAM,OACN,QAAS,SACX,EAOA,KAAM,CACJ,KAAM,OACN,QAAS,EACX,EAOA,OAAQ,CACN,KAAM,MACN,QAAS,IAAiC,CAAA,CAC5C,EAOA,OAAQ,CACN,KAAM,OACN,QAAS,EACX,EAOA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,KAAM,OACR,EAEA,MAAMC,EAAO,CACX,IAAIC,EAAsB,KAC1B,MAAMC,EAAQC,IAERC,EAAcC,EAAS,KAAO,CAClC,oBAAqB,GACrB,GAAGL,EAAM,OACX,EAAE,EAEF,OAAAM,EAAU,SAAY,CACpB,KAAM,CAAE,QAASC,CAAK,EAAI,KAAM,QACC,MACjC,EAEAN,EAAS,IAAIM,EAAKL,EAAM,MAAQE,EAAY,KAAK,CACnD,CAAC,EAEDI,EAAc,IAAM,CAClB,GAAI,CACFP,GAAQ,QAAA,CACV,MAAuB,CAGzB,CAAA,CAAC,EAEM,IACLQ,EACE,MACA,CACE,MAAO,kBACP,MAAO,CACL,MAAOT,EAAM,KACf,CACF,EACA,CACES,EACE,IACA,CACE,MAAO,UACP,KAAMC,EAAQC,EAAQX,EAAM,GAAG,EAAIA,EAAM,IAAI,CAAC,EAAE,IAAMA,EAAM,GAAG,CACjE,EACAA,EAAM,KACR,EACAS,EACE,QACA,CACE,IAAKP,EACL,MAAOF,EAAM,MACb,YAAa,YACb,OAAQU,EAAQV,EAAM,MAAM,EAC5B,QAAS,WACT,SAAU,GACV,GAAIA,EAAM,KAAO,CAAE,KAAM,EAAG,EAAI,CAAA,CAClC,EACA,CACEA,EAAM,OAAO,IAAKY,GAChBH,EAAE,QAAS,CAAE,GAAGG,EAAO,IAAKF,EAAQE,EAAM,GAAG,CAAE,CAAC,CAClD,EACAD,EAAQX,EAAM,GAAG,EACbA,EAAM,IAAI,IAAKa,GAASJ,EAAE,SAAUI,CAAI,CAAC,EACzCJ,EAAE,SAAU,CAAE,IAAKC,EAAQV,EAAM,GAAG,EAAG,KAAMA,EAAM,IAAK,CAAC,CAC/D,CACF,CACF,CACF,CACJ,CACF,CAAC"}