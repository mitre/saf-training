---
title: 3. Delta Process CLI Tools
author: Daniel Medina, George Dias
---

The [SAF CLI](https://saf-cli.mitre.org/) is a collection of libraries and tools developed by MITRE and the security community to streamline security automation for systems and DevOps pipelines. The delta process is one of the capabilities provided by the SAF CLI.

## 3.1 The Two Delta Commands

The SAF CLI provides two commands for profile updates. Let's understand when to use each:

### Quick Update: `update_controls4delta`

**Use when**: You need to rename controls and update metadata between baseline versions

**What it does**:
- Renames controls based on XCCDF legacy ID mappings
- Updates control metadata from new guidance
- Preserves all your test code (describe blocks)

**What it does NOT do**:
- Generate new controls
- Handle completely changed control IDs (no legacy mapping)

**Example scenario**: RHEL 8 V1R13 → V1R14 (minor revision update)

### Comprehensive Update: `delta`

**Use when**: Major baseline changes or you're unsure what changed

**What it does**:
- Everything `update_controls4delta` does
- PLUS generates stubs for new controls
- PLUS fuzzy matching (optional) when IDs changed completely
- PLUS detailed markdown reports

**Example scenario**: Windows Server 2019 → Windows Server 2022 (major platform change)

### Decision Guide

```
Just renaming controls with clear ID mappings? → update_controls4delta
Need stubs for new controls? → delta
Control IDs completely changed? → delta with fuzzy matching (-M flag)
Not sure what changed? → delta (it's comprehensive)
```

::: info About InSpec Profile Files
When we refer to "InSpec profile" in this course, there are two meanings:

- **InSpec profile repository**: The directory containing controls, inspec.yml, libraries, etc.
- **InSpec profile summary**: A JSON file (`profile.json`) generated with `inspec json` command, used as input to delta

Context will make clear which one we mean.
:::

### 3.2 Update Controls for Delta

The `update_controls4delta` process is used to prepare profile controls from one [SRG](./02.md#glossary-of-terms) or [STIG/CIS](./02.md#glossary-of-terms) benchmark baseline to another. The controls are updated based on guidance provided by the appropriate Extendible Configuration Checklist Description Format ([XCCDF](./02.md#glossary-of-terms)).

The `update_controls4delta` process may be the only command needed as it specifically updates existing controls from one baseline to another, refer to [use cases for running delta](./04.html#use-cases-for-running-delta).

The process requires three inputs:

1. The controls directory from your existing InSpec profile (baseline X)
2. An InSpec profile summary JSON file containing baseline X controls
   a. Generated using the `inspec json` or `cinc-auditor json` command
3. An XCCDF file containing the new baseline Y guidance
   a. The XCCDF lists all controls for the new baseline
   b. It includes a "legacy" field mapping old control IDs to new IDs
   c. The process uses these legacy mappings to update your controls
   d. If no mapping is found, you'll need to use the `delta` command instead ([see use cases](./04.html#use-cases-for-running-delta))

You can invoke the command as such:
```sh
saf generate update_controls4delta \
-X ./baseline_Y_xccdf_guidance_file.xml \
-J baseline_X_summary.json \
-c baseline_X_controls_directory
```

To see all available options, use the help flag:
```sh
saf generate update_controls4delta --help
```

**Control ID Mapping Options**:
Controls can be renamed using either:
- **Rule ID** (default): Uses XCCDF legacy fields to map old IDs to new IDs
- **Group ID**: Uses group identifiers instead

If the XCCDF contains no legacy mappings between baseline X and baseline Y, `update_controls4delta` will not update any controls. In this case, use the `delta` command with fuzzy matching instead.

### 3.3 Delta

The `delta` command extends `update_controls4delta` with additional capabilities:

1. **Creates new controls**: Generates stubs for controls added in the new guidance
2. **Fuzzy matching** (optional):
   a. Maps controls based on text similarity instead of control IDs
   b. When a match is found, copies the describe block (test code) from the old control to the new control
   c. Useful when control IDs completely changed between baselines
3. **Detailed logging**: Generates markdown reports (.md) and statistics (CliProcessOutput.log)

**Command syntax**:

```sh
saf generate delta \
-X ./baseline_Y_xccdf_guidance_file.xml \
-J baseline_X_summary.json \
-o new_baseline_Y_controls_directory \
-M -c baseline_X_controls_directory
```

::: tip Fuzzy Matching Flags
The `-M` (enable fuzzy matching) and `-c` (controls directory for matching) flags are optional. Remove them if you don't need fuzzy matching.
:::

To see all available options:
```sh
saf generate delta --help
```

**Additional Resources**:
- [update_controls4delta documentation](https://saf-cli.mitre.org/#delta-supporting-options)
- [saf generate delta documentation](https://saf-cli.mitre.org/#delta)

::: warning Delta Process Limitations
The delta process has been tested primarily with DISA XCCDF STIG Benchmark files. Use with CIS Benchmarks may require additional validation.
:::
