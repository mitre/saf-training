---
title: 4. Delta Use Cases
author: Daniel Medina, George Dias
---

## 4.1 Use Cases for Running Delta

There are three common scenarios that warrant using the delta process:

1. [Use Case 1](#411-use-case-1) - Update control IDs and metadata based on new guidance (run update_controls4delta)

2. [Use Case 2](#412-use-case-2) - Generate stubs for new controls found in the XCCDF Benchmark file (run delta without fuzzy matching)

3. [Use Case 3](#413-use-case-3) - No mappings were found using update_controls4delta (run delta with fuzzy matching)



### 4.1.1 Use Case 1

Updated guidance sometimes modifies the control identification (ID) values. To handle these changes from baseline X to baseline Y, we use the `update_controls4delta` command with the new XCCDF guidance file. The process checks if the new guidance changes control IDs and updates the metadata while preserving all testing code.

Let's walk through an example: updating the [Windows Server 2019 InSpec profile](https://github.com/mitre/microsoft-windows-server-2019-stig-baseline/) from [version 1 release 3](https://github.com/mitre/microsoft-windows-server-2019-stig-baseline/releases/tag/1.3.0) to version 3 release 2.

#### Step 1: Collect Necessary Files

1. Download or clone the Windows Server 2019 profile repository to your system
2. Download the [latest STIG](https://public.cyber.mil/stigs/downloads/) and place the XCCDF XML file into your working directory

![File directory containing an inspec profile and an XCCDF XML file](/assets/img/Delta_Class/Delta_Files_1.png)

#### Step 2: Generate a profile summary
Use the `inspec json` command to generate a profile summary of the inspec profile
![Generate Profile Summary JSON](/assets/img/Delta_Class/use_case_1-1.gif)


#### Step 3: Run Update Controls
Use the `update_controls4delta` method using the profile summary file, the STIG guidance file, and the controls directory for the inspec profile as inputs.
```sh
saf generate update_controls4delta \
-X ./windows-server-2019-v3r2-xccdf.xml \
-J ./profile.json \
-c ./microsoft-windows-server-2019-stig-baseline/controls
```
![Running the Update Controls command](/assets/img/Delta_Class/use_case_1-2.gif)

The output should look like this:

![Update Controls Output](/assets/img/Delta_Class/use_case_1-3.png)

From these results, we can see that:
1. Thirty-one (31) controls were skipped because they're not present in the new STIG guidance - these controls were removed in the recent revision
2. Two-hundred-seventy-two (272) controls had their control IDs updated, along with any metadata changes
3. Zero (0) controls were found to have the correct identification - the STIG guidance renamed all mapped controls
4. One (1) new control was found in the STIG guidance. Note that `update_controls4delta` does NOT generate this new control for you

**Process Used:** `update_controls4delta`

[Return to top](#41-use-cases-for-running-delta)

### 4.1.2 Use Case 2

New guidance often contains new controls that weren't previously defined. In this case, running the delta process generates the control stubs with all metadata, except for the describe block (code) content.

Suppose we want to update our [RedHat Enterprise Linux 8 STIG Baseline](https://github.com/mitre/redhat-enterprise-linux-8-stig-baseline) from [Version 1 Release 14](https://github.com/mitre/redhat-enterprise-linux-8-stig-baseline/releases/tag/v1.14.1) to version 2 release 1.

#### Step 1: Collect necessary files

![File directory containing an InSpec profile, XCCDF XML file, and generated profile summary JSON](/assets/img/Delta_Class/use_case_2_1.png)

This includes the profile summary JSON file generated using `cinc-auditor json redhat-enterprise-linux-8-stig-baseline > profile.json`

#### **OPTIONAL**: Run update_controls4delta
Running the update controls command on this profile can give us information on what needs to be updated:
```sh
saf generate update_controls4delta \
-X rhel_8_xccdf.xml \
-J profile.json \
-c ./redhat-enterprise-linux-8-stig-baseline/controls
```

![update_controls4delta output](/assets/img/Delta_Class/use_case_2-2.png)

From this we can gather:
1. No existing controls needed to be renamed in the new STIG guidance (366 controls with correct identification, 0 processed files).
2. Nine (9) controls were removed in the updated STIG guidance (9 skipped files).
3. One (1) new control was found in the updated STIG guidance. 

From this output, we know that the Delta command needs to be run, because Delta is able to generate files for new controls and make any changes needed to the other controls.

#### Step 2: Run Delta

Use the `delta` command to perform a delta on the profile and the STIG guidance file:
```sh
saf generate delta \
-X ./rhel_8_V2R1_xccdf.xml \
-J ./profile.json \
-r ./report.md -o ./redhat-8-updated/
```
In this case, we will be outputting a report file to `report.md` and the updated inspec profile to the `./redhat-8-updated/` directory.

You should receive the following output:
![Delta command output](/assets/img/Delta_Class/use_case_2-3.png)

The `["+","SV-268322"]` indicates that a new control was created with the ID SV-258322.

After running the command, you should see the following:

![Generated files and folders from delta](/assets/img/Delta_Class/use_case_2-4.png)

1. `redhat-8-updated` directory: A folder containing the updated InSpec profile

    ![Updated profile output directory](/assets/img/Delta_Class/use_case_2-5.png)

    a. A `controls` directory with all updated and new controls from the STIG guidance file (removed controls are NOT included, so no further cleanup needed)
    b. A `delta.json` file containing a JSON-formatted summary of the delta process
2. `report.md`: A markdown report containing a formatted version of the delta.json summary results
3. `saf-cli.log`: A log of the SAF CLI output from running the command

**Process Used:** `delta`

[Return to top](#41-use-cases-for-running-delta)

### 4.1.3 Use Case 3

Running `update_controls4delta` may result in no controls being updated or no mappings found from baseline X to baseline Y. This happens when:
- Baselines belong to different platforms (e.g., RHEL â†’ Windows)
- Too many revisions released between baselines (legacy mappings lost)
- Control IDs completely changed with no legacy field references

In this case, we use `delta` with fuzzy matching.

**Example**: We'll map the Windows Server 2019 STIG profile to Windows Server 2022 STIG guidance to determine how much of our old profile can be reused. These baselines share no control ID similarities and have no legacy tags for correlation.

#### Step 1: Collect Necessary Files

![File directory containing an InSpec profile, XCCDF XML file, and generated profile summary JSON](/assets/img/Delta_Class/use_case_3-1.png)

#### Step 2: Run the delta command with fuzzy matching

To enable fuzzy matching, use the `-M` flag and specify the controls directory using the `-c` flag:
```sh
saf generate delta \
-X ./windows-server-2022-v2r2-xccdf.xml \
-J ./profile.json -r ./report.md \
-o ./windows-server-2022-stig-baseline \
-M -c ./microsoft-windows-server-2019-stig-baseline/controls
```

The output is long, but what's important is the results and statistics section:
![Delta fuzzy matching command output](/assets/img/Delta_Class/use_case_3-2.png)

We can observe that:
1. Delta found 266 total matches and mapped these matched controls over into the new profile.
2. Delta was unable to find matches for 6 of the controls in the Windows Server 2022 STIG guidance (No Match Controls).

Of the 273 controls specified by the Windows Server 2022 STIG guidance, delta found mappings for 266 of them. This means that about 97% of the Windows Server 2019 profile was able to be used for the Windows Server 2022 profile.

Similar to Use Case 2, we'll see the same generated files:
1. `windows-server-2022-stig-baseline` directory containing:
   a. A `controls` directory with the mapped controls and updated metadata
   b. A `delta.json` file with a summary of the delta process
2. `report.md`: Markdown-formatted report
3. `saf-cli.log`: Command execution log

**Process Used:** `delta` with fuzzy matching

[Return to top](#41-use-cases-for-running-delta)
