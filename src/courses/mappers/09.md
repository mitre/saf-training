---
order: 9
next: 10.md
title: Mapper Preparations - OHDF Converters
author: Charles Hu
---

## An Overview of OHDF Converters

OHDF Converters is the library that hosts and provides OHDF mappers to other applications in the SAF tool suite. It is important to have a general understanding of a few key features of OHDF Converters as the mappers you develop will be integrated here and leverage the library's utilities.

### Features

- Implements OHDF mappers to transform security data formats to and from OHDF.
- Special keyword functions provided by the <i>base-converter</i> class.
- Fingerprinting services for automatic data format identification.

### Keywords

<i>base-converter</i> is an underlying class which enables \*-to-HDF mapping in OHDF Converters. It defines \*-to-HDF mappers and provides critical tools in the form of keywords which allow for the construction of such mappers. All \*-to-HDF mappers inherit from this class and therefore have access to the keywords that this class provides. You should aim to utilize these keywords to their fullest potential to ease and simplify mapper development. The provided tools are as follows:

- `path`: Define JSON object path to go to. Paths are found recursively (for example, if a top-level field has the path `result`, then all fields below it will only see the `result` field of the source file). To escape this recursion, we can make use of the `$` symbol at the beginning of the path. 
  - Use:
  ```typescript
  path: PATH_AS_STRING
  ```
  - Example:
  ```typescript
  // Attribute 'id' will be set as whatever JSON object attribute 'vulnerability.id' is
  id: {path: 'vulnerability.id'}
  ```
  - Example of recursion:
  ```typescript
  controls: [
    {
      path: 'result',
      id: {path: 'id'} // This is grabbing from the path 'result.id', not just 'id'
    }
  ]
  ```
  - Example of escaping from recursion:
  ```typescript
  controls: [
    {
      path: 'result',
      id: {path: '$id'} // This is grabbing from the top-level path 'id'
    }
  ]
  ```

- `transformer`: Sometimes, source data is not formatted in the way we desire. To remedy this, we can make use of the `base-converter` `transformer` functionality. The `transformer` accepts a function as a parameter. This can either be an anonymous funciton or a normal, named function. This transformer acts as a callback function that will go to the specified path location and modify the data accordingly. See the following example, where we apply a transformer that maps nist tags to CCI tags. 
  - Use:
  ```typescript
  transformer: (PARAMETER: TYPE): OUTPUT_TYPE => {CODE_TO_EXECUTE}
  ```
  - Example:
  ```typescript
  // Attribute 'cci' will be set as the returned CCI tag from the ingested 'data' argument
  cci: {
    path: 'vulnerabilityClassifications',
    transformer: (data: string) => getCCIsForNISTTags(nistTag(data))
  }
  ```

- `arrayTransformer`: The `arrayTransformer` works similarly to the `transformer` in that it takes our in-progress mapping for the array structure, accepts a function that returns an array, and transforms the array accordingly (whether it be filtering out some items, passing in some additional data, or otherwise). 
  - Use:
  ```typescript
  arrayTransformer: (PARAMETER: TYPE[]): OUTPUT_TYPE[] => {CODE_TO_EXECUTE}
  ```
  - Example:
  ```typescript
  controls: [
    {
      path: '...', // Some path to the array in the source file
      // The function 'deduplicateId' will run against all items in the current array that the 'arrayTransformer' was called inside
      arrayTransformer: deduplicateId
    }
  ]
  ```
In the above code block, the `arrayTransformer` is used in the controls array of the mapping, which creates a control for every item in the source file's specified path location. However, this array may contain duplicate items (with the same IDs). Thus, the `arrayTransformer` is being leveraged to de-duplicate items with the same ID and collapse them into one element. 

- `pathTransform`: Converts the JSON object path structure. This preprocesses the source file before *any* of the other keywords are run. We only use this as a last resort if the source file needs to be drastically reworked. Using the `pathTransform` can be difficult to work through, since the intermediate format generated by it is not saved to disk anywhere. 

  - Use:
  ```typescript
  pathTransform: (PARAMETER: TYPE): OUTPUT_TYPE => {CODE_TO_EXECUTE}
  ```
  - Example:
  ```typescript
  // Returns the JSON path if it is an array, otherwise returns an empty array
  pathTransform: (value) => (Array.isArray(value) ? value : []),
  ```

- `key`: Used by <i>base-converter</i> to sort an array of objects by. Currently, this is only used in the `controls` array area to automatically de-duplicate elements with the same key to ensure that they are unique. Thus, we have only ever been passing `id` as a `key`. When calling the constructor for the mapper, we can set `collapseResults=true` to make use of this automatic deduplication function.
  - Use:
  ```typescript
  key: KEY_AS_STRING
  ```
  - Example:
  ```typescript
  // 'id' is now the key by which this array will be sorted by
  key: 'id'
  ```

### Directory Structure

The following is a simplified depiction of the directory tree for the HDF Converters. Only noteworthy and potentially useful files and directories are included. It is not imperative to memorize the structure, but it is useful to familiarize yourself with it to better understand what exists where within the library for future reference.

```
hdf-converters
+-- data
|   +-- converters
|   |   +-- csv2json.ts
|   |   +-- xml2json.ts
+-- sample_jsons                            // Sample exports for mapper testing are located here
+-- src                                     // *-to-HDF mappers are located here
|   +-- converters-from-hdf                 // HDF-to-* mappers are located here
|   |   +-- reverse-any-base-converter.ts
|   |   +-- reverse-base-converter.ts
|   +-- mappings                            // Non-HDF mappers are located here (e.g., CVE, CCI, NIST)
|   +-- utils
|   |   +-- fingerprinting.ts
|   |   +-- global.ts
|   +-- base-converter.ts
+-- test                                    // Mapper tests are located here
|   +-- mappers
|   |   +-- forward                         // *-to-HDF tests
|   |   +-- reverse                         // HDF-to-* tests
|   |   +-- utils.ts
+-- types                                   // Explicit data typing for known export schemas
+-- index.ts
+-- package.json
```
