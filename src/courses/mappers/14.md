---
order: 14
next: 15.md
title: Demo - Implementing a Mapper
author: Charles Hu
---


WORKING TO REFACTOR FOLLOWING SECTION

[placeholder]

## Mapper Creation <a name="create"></a>

### \*-to-HDF Creation Guide <a name="guide"></a>


4. Set up for \*-to-HDF mapper development.

  - 4a. 

  - 4b. Create a blank TypeScript file under the <i>src</i> directory in <i>hdf-converters</i>. It should be named:

    ```
    {YOUR-EXPORT-NAME-HERE}-mapper.ts
    ```

  - 4c. Select the appropriate <b>[mapper skeleton](#skeleton)</b> for your export type. Place them in the file created in step 4b. Replace names (<i>skeleton</i> by default) as necessary.

  - 4d. Export your mapper class created in the previous steps by specifying its export in the <i>index.ts</i> file. Add the following line:

    ```
    export * from './src/{YOUR-EXPORT-NAME-HERE}-mapper';
    ```

  - 4e. Create a new directory named <i>{YOUR-EXPORT-NAME-HERE}_mapper</i> under the <i>sample_jsons</i> directory in <i>hdf-converters</i>. Create another directory named <i>sample_input_report</i> in the directory you just made. The file structure should look like this:

    ```
    +-- sample_jsons
    |   +-- {YOUR-EXPORT-NAME-HERE}-mapper
    |   |   +-- sample_input_report
    ```

  - 4f. Place your sample export under the <i>sample_input_report</i> directory. Your sample export should be genericized to avoid any leaking of sensitive information. The file structure should now look like this:

    ```
    +-- sample_jsons
    |   +-- {YOUR-EXPORT-NAME-HERE}-mapper
    |   |   +-- sample_input_report
    |   |   |   +-- {YOUR-SAMPLE-EXPORT}
    ```

  - 4g. Create a blank TypeScript file under the <i>test/mappers/forward</i> directory in <i>hdf-converters</i>. It should be named:

    ```
    {YOUR-EXPORT-NAME-HERE}_mapper.spec.ts
    ```

  - 4h. Select the appropriate <b>[mapper testing skeleton](#skeleton)</b> for your export type. Place it in the file created in step 4g. Replace names (<i>skeleton</i> by default) as necessary.

5. Add fingerprinting to identify your security service scan export.

  - 5a. Go to the file <i>report_intake.ts</i> under the <i>heimdall2/apps/frontend/src/store</i> directory.

  - 5b. Import your mapper file. You should be able to add the name of your mapper class to a pre-existing import statement pointing at <i>hdf-converters</i> as follows:

    ```
    import {
      ASFFResults as ASFFResultsMapper,
      BurpSuiteMapper,
      ...
      {YOUR-MAPPER-CLASS-HERE}
    } from '@mitre/hdf-converters';
    ```

  - 5c. Instantiate your mapper class in the <i>convertToHdf</i> switch block. Add the following lines:

    ```
    case '{YOUR-EXPORT-SERVICE-NAME-HERE}':
      return new {YOUR-MAPPER-CLASS-HERE}(convertOptions.data).toHdf();
    ```

  - 5d. Navigate to the file <i>fingerprinting.ts</i> in the <i>src/utils</i> directory in <i>hdf-converters</i>. Add keywords that are unique to your sample export to the <i>fileTypeFingerprints</i> variable. It should be formatted as follows:

    ```
    export const fileTypeFingerprints = {
      asff: ['Findings', 'AwsAccountId', 'ProductArn'],
      ...
      {YOUR-EXPORT-SERVICE-NAME-HERE}: [{UNIQUE KEYWORDS AS STRINGS}]
    };
    ```

6. Create the \*-to-HDF mapper.

  - 6a. Return to the <i>{YOUR-EXPORT-NAME-HERE}-mapper.ts</i> file. In the file, you should have a generic skeleton mapper picked according to your export type.

  - 6b. Certain security services produce exports which are not immediately usable by the skeleton mapper. In this case, pre-processing on the export and post-processing on the generated HDF file is necessary in order to ensure compatibility.

  - 6c. The skeleton mapper and <b>[<i>base-converter</i>](#base)</b> have been designed to provide the base functionality needed for \*-to-HDF mapper generation. For most developers, mapper creation will be limited to assigning objects from the export structure to correlating attributes in the mapper according to the HDF schema.
    
    - An example of this process is provided in the <b>[\*-to-HDF Mapper Construction Example](#example2)</b> section.

  - 6d. [Commit your changes](https://github.com/git-guides/git-commit) with the [signoff option](https://git-scm.com/docs/git-commit) and [push the changes](https://github.com/git-guides/git-push) to your development branch. This should queue up the Github Actions pipeline which includes a Netlify instance of Heimdall2 which you can use to test if your mapper is generating a HDF file correctly.

[placeholder]
